@model List<ProjectSEM3.Models.Entities.QuestionView>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";

    <!-- Define countdown time -->
    var endTime = DateTime.UtcNow.AddSeconds(425);
    var timeRemaining = TimeSpan.FromTicks(endTime.Ticks - DateTime.UtcNow.Ticks).TotalSeconds.ToString("#");
}

<div class="quiz-wrapper pt-5">
    <div class="container-fluid" style="z-index: 1">
        <div class="container">
            <div id="wizard">
                @foreach (var item in Model)
                {
                    var answer = "answer-a" + (Model.IndexOf(item) + 1);
                    var question = "question-q" + (Model.IndexOf(item) + 1);
                    var index = Model.IndexOf(item) + 1;
                    <div id="questDisplay" class="multisteps_form_panel">
                        <h1 class="question_title text-center" id="@question">@item.Content</h1>
                        <div class="form_items d-flex flex-column justify-content-center">
                            @foreach (var option in item.Options)
                            {
                                <div class="answer-container rounded-pill bg-white text-start">
                                    <input type="radio" onclick="addAnswer(@index)" name="@answer" value="@option">@option
                                </div>
                            }
                        </div>
                    </div>
                }

                <div class="form_btn action-btns text-center ms-5 mt-5">
                    <button type="button" onclick="submitQuiz()" class="f_btn text-uppercase rounded-pill border-0">Submit</button>
                </div>
            </div>
        </div>

        <div class="container text-center mt-5 mb-5">
            <div class="d-flex justify-content-evenly align-items-center section-wrapper">
                <div class="d-flex flex-column justify-content-center text-center">
                    <div>
                        <button type="button" class="btn" style="display: inline;">1</button>
                    </div>
                    <div class="mt-3">
                        <span style="color: #000a38; font-size: 1rem">General Knowledge</span>
                    </div>
                </div>
                <div class="d-flex flex-column justify-content-center text-center">
                    <div>
                        <button type="button" class="btn" style="display: inline;">2</button>
                    </div>
                    <div class="mt-3">
                        <span style="color: #000a38; font-size: 1rem">Mathematics</span>
                    </div>
                </div>
                <div class="d-flex flex-column justify-content-center text-center">
                    <div>
                        <button type="button" class="btn" style="display: inline;">3</button>
                    </div>
                    <div class="mt-3">
                        <span style="color: #000a38; font-size: 1rem">Computer Technology</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex text-center justify-content-center align-items-center timer-wrapper">
            <div>
                <span id="minRemaining"></span>
            </div>
            <div>
                <span>:</span>
            </div>
            <div>
                <span id="secRemaining"></span>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    localStorage.removeItem("lstResult")
    /*-----------------------------------
        Countdown
    -------------------------------------*/
    var remSeconds = @timeRemaining;
    var secCounter = remSeconds % 60;

    function formatNumber(number) {
        if (number < 10) return '0' + number;
        else return '' + number;
    }
    function startTick() {
            document.getElementById("secRemaining").innerText = formatNumber(secCounter);
            document.getElementById("minRemaining").innerText = formatNumber(parseInt(remSeconds / 60));

        var _tick = setInterval(function () {
            if (remSeconds > 0 && secCounter == 0) {
                remSeconds = remSeconds - 1;
                secCounter = 60 - 1;
                document.getElementById("secRemaining").innerText = formatNumber(secCounter);
                document.getElementById("minRemaining").innerText = formatNumber(parseInt(remSeconds / 60));
            }
            else if (remSeconds > 0 && secCounter != 0) {
                 remSeconds = remSeconds - 1;
                 secCounter = secCounter - 1;
                 document.getElementById("secRemaining").innerText = formatNumber(secCounter);
                 document.getElementById("minRemaining").innerText = formatNumber(parseInt(remSeconds / 60));
                 if (secCounter == 0)
                    secCounter = 60;
            }
            else {
                 alert('Times out!');
                 clearInterval(_tick);
                 submitQuiz();
                }
            }, 1000);
    }
    startTick();

    /*-----------------------------------
        Handle Content
    -------------------------------------*/
  let selectedAnswers = {};
  let lstTemp = [];

  function addAnswer(index) {
      let answered = document.getElementsByName("answer-a" + index);
      let questioned = document.getElementById("question-q" + index);
      console.log(questioned.innerHTML);
      for (var i = 0; i < answered.length; i++) {
          let currentOption = answered[i];
          if (currentOption.checked == true) {
              selectedAnswers[`${questioned.innerHTML}`] = currentOption.value;
          }
      }
  };
  function submitQuiz() {
      let questSubmit = Object.keys(selectedAnswers);
      for (var i = 0; i < questSubmit.length; i++) {
          var temp = { question: "", answer: "" };
          temp.question = questSubmit[i];
          temp.answer = selectedAnswers[Object.keys(selectedAnswers)[i]];
          lstTemp.push(temp);
      }
      console.log(lstTemp);
      localStorage.setItem("lstResult", JSON.stringify(lstTemp));

      $.ajax({
          type: "POST",
          data: { result: localStorage.getItem("lstResult") },
          dataType: "json",
          url: "/Quiz/SubmitMath",
          success: function (result) {
              console.log(result);
              window.location.href = "https://localhost:44376/Quiz/Quiz_Computer";
          },
          error: function (req, status, error) {
              console.log(error);
          }
      });
  };

</script>



