@model List<ProjectSEM3.Models.Entities.Question.Req>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";

    <!-- Define countdown time -->
    var endTime = DateTime.UtcNow.AddSeconds(425);
    var timeRemaining = TimeSpan.FromTicks(endTime.Ticks - DateTime.UtcNow.Ticks).TotalSeconds.ToString("#");

    <!-- Get Question List -->
    var lst = ViewData["lstQuest"];
}

<div class="quiz-wrapper pt-5">
    <div class="container-fluid" style="z-index: 1">
        <div class="row text-center">
            <div class="col d-flex flex-row justify-content-evenly d-none d-sm-block">
                <span class="step bg-white rounded-pill finish finish"></span>
                <span class="step bg-white rounded-pill active"></span>
                <span class="step bg-white rounded-pill"></span>
                <span class="step bg-white rounded-pill"></span>
                <span class="step bg-white rounded-pill"></span>
            </div>
        </div>

        <div class="container">
            <div id="wizard">
                <div id="questDisplay" class="multisteps_form_panel">
                    <span class="question_number text-uppercase d-flex justify-content-center align-items-center">
                        Question
                        <span id="question-number" class="d-flex justify-content-center ms-1" style="margin-top: 16px">1</span>/5
                    </span>

                    <h1 id="question-content" class="question_title text-center">Quest 1</h1>
                    <div id="answer-button" class="form_items d-flex flex-column justify-content-center">

                        <button id="btn1" class="btn rounded-pill bg-white text-start mb-3" style="height: 50px">Answer A</button>
                        <button id="btn2" class="btn rounded-pill bg-white text-start mb-3" style="height: 50px">Answer B</button>
                        <button id="btn3" class="btn rounded-pill bg-white text-start mb-3" style="height: 50px">Answer C</button>
                        <button id="btn4" class="btn rounded-pill bg-white text-start" style="height: 50px">Answer D</button>

                    </div>
                </div>

                <div class="form_btn text-center ms-5 mt-5">
                    <button type="button" class="f_btn text-uppercase rounded-pill border-0" id="prevBtn" style="display: inline;">Prev Question</button>
                    <button type="button" class="f_btn text-uppercase rounded-pill border-0" id="nextBtn">Next Question</button>
                </div>
            </div>
                @*<div id="questDisplay" class="multisteps_form_panel">
                    <span class="question_number text-uppercase d-flex justify-content-center align-items-center">
                        Question
                        <span id="question-number" class="d-flex justify-content-center ms-1" style="margin-top: 16px">1</span>/5
                    </span>

                    <h1 id="question-content" class="question_title text-center">Question goes here</h1>
                    <div class="form_items answer-input d-flex justify-content-center">
                        <ul class="answer-input ps-0">
                            <li id="li1" class="step_1 rounded-pill bg-white text-start">
                                <input type="radio" id="opt_1" name="stp_1_select_option" value="Answer A">
                                <label id="lb_1" for="opt_1">Answer A</label>
                            </li>
                            <li class="step_1 rounded-pill bg-white">
                                <input type="radio" id="opt_2" name="stp_1_select_option" value="Answer B">
                                <label id="lb_2" for="opt_2">Answer B</label>
                            </li>
                            <li class="step_1 rounded-pill bg-white">
                                <input type="radio" id="opt_3" name="stp_1_select_option" value="Answer C">
                                <label id="lb_3" for="opt_3">Answer C</label>
                            </li>
                            <li class="step_1 rounded-pill bg-white">
                                <input type="radio" id="opt_4" name="stp_1_select_option" value="Answer D">
                                <label id="lb_4" for="opt_4">Answer D</label>
                            </li>
                        </ul>

                    </div>
                </div>

                <div class="form_btn text-center ms-5 mt-5">
                    <button type="button" class="f_btn text-uppercase rounded-pill border-0" id="prevBtn" style="display: inline;">Prev Question</button>
                    <button type="button" class="f_btn text-uppercase rounded-pill border-0" id="nextBtn">Next Question</button>
                </div>*@
        </div>

        <div class="container text-center mt-5 mb-5">
            <div class="d-flex justify-content-evenly align-items-center section-wrapper">
                <div class="d-flex flex-column justify-content-center text-center">
                    <div>
                        <button type="button" class="btn" style="display: inline;">1</button>
                    </div>
                    <div class="mt-3">
                        <span style="color: #000a38; font-size: 1rem">General Knowledge</span>
                    </div>
                </div>
                <div class="d-flex flex-column justify-content-center text-center">
                    <div>
                        <button type="button" class="btn" style="display: inline;">2</button>
                    </div>
                    <div class="mt-3">
                        <span style="color: #000a38; font-size: 1rem">Mathematics</span>
                    </div>
                </div>
                <div class="d-flex flex-column justify-content-center text-center">
                    <div>
                        <button type="button" class="btn" style="display: inline;">3</button>
                    </div>
                    <div class="mt-3">
                        <span style="color: #000a38; font-size: 1rem">Computer Technology</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex text-center justify-content-center align-items-center timer-wrapper">
            <div>
                <span id="minRemaining"></span>
            </div>
            <div>
                <span>:</span>
            </div>
            <div>
                <span id="secRemaining"></span>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    /*-----------------------------------
        Countdown
    -------------------------------------*/
    var remSeconds = @timeRemaining;
    var secCounter = remSeconds % 60;

    function formatNumber(number) {
        if (number < 10) return '0' + number;
        else return '' + number;
    }
    function startTick() {
            document.getElementById("secRemaining").innerText = formatNumber(secCounter);
            document.getElementById("minRemaining").innerText = formatNumber(parseInt(remSeconds / 60));

        var _tick = setInterval(function () {
            if (remSeconds > 0 && secCounter == 0) {
                remSeconds = remSeconds - 1;
                secCounter = 60 - 1;
                document.getElementById("secRemaining").innerText = formatNumber(secCounter);
                document.getElementById("minRemaining").innerText = formatNumber(parseInt(remSeconds / 60));
            }
            else if (remSeconds > 0 && secCounter != 0) {
                 remSeconds = remSeconds - 1;
                 secCounter = secCounter - 1;
                 document.getElementById("secRemaining").innerText = formatNumber(secCounter);
                 document.getElementById("minRemaining").innerText = formatNumber(parseInt(remSeconds / 60));
                 if (secCounter == 0)
                    secCounter = 60;
            }
            else {
                    alert('Times out!');
                    clearInterval(_tick);
                }
            }, 1000);
    }
    startTick();

    /*-----------------------------------
        Save Quest list into local storage
    -------------------------------------*/
    var lstQuest = @Html.Raw(Json.Encode(lst));
    var data = lstQuest.Data;
    console.log(data);
    let index = 0;
    let score = 0;

    /*-----------------------------------
        Display question
    -------------------------------------*/

    var questNum = document.getElementById("question-number");
    const questContent = document.getElementById("question-content");
    const answer = document.getElementById("answer-button");
    const btn1 = document.getElementById("btn1");
    const btn2 = document.getElementById("btn2");
    const btn3 = document.getElementById("btn3");
    const btn4 = document.getElementById("btn4");
    const nextButton = document.getElementById("nextBtn");
    const prevButton = document.getElementById("prevBtn");

    function startQuiz() {
        index = 0;
        score = 0;
        showQuestion();
    };

    function showQuestion() {
        resetState();
        let currentQuestion = data[index].Content;
        let questNo = index + 1;

        questNum.innerHTML = questNo;
        questContent.innerHTML = currentQuestion;
        const button1 = document.createElement("button");
        button1.innerHTML = data[index].A;
        button1.classList.add("btn", "rounded-pill", "bg-white", "text-start", "mb-3");
        answer.appendChild(button1);
        button1.dataset.selected = data[index].Status;
        button1.addEventListener("click", selectAnswer);
        //btn1.innerHTML = data[index].A;
        const button2 = document.createElement("button");
        button2.innerHTML = data[index].B;
        button2.classList.add("btn", "rounded-pill", "bg-white", "text-start", "mb-3");
        answer.appendChild(button2);
        button2.dataset.selected = data[index].Status;
        button2.addEventListener("click", selectAnswer);
        //btn2.innerHTML = data[index].B;
        const button3 = document.createElement("button");
        button3.innerHTML = data[index].C;
        button3.classList.add("btn", "rounded-pill", "bg-white", "text-start", "mb-3");
        answer.appendChild(button3);
        button3.dataset.selected = data[index].Status;
        button3.addEventListener("click", selectAnswer);
        //btn3.innerHTML = data[index].C;
        const button4 = document.createElement("button");
        button4.innerHTML = data[index].D;
        button4.classList.add("btn", "rounded-pill", "bg-white", "text-start", "mb-3");
        answer.appendChild(button4);
        button4.dataset.selected = data[index].Status;
        button4.addEventListener("click", selectAnswer);
        //btn4.innerHTML = data[index].D;
    }

    function resetState() {
        prevButton.style.display = "none";
        while (answer.firstChild) {
            answer.removeChild(answer.firstChild);
        };
    };

    function selectAnswer(e) {
        const selectedBtn = e.target;
        console.log(selectedBtn.dataset);
        const isSelected = selectedBtn.dataset.selected === "true";
        if (isSelected) {
            selectedBtn.classList.add("selected");
        }
    };

    function handleNextButton() {
        index++;
        if (index < data.length) {
            showQuestion();
        }
    };

    nextButton.addEventListener("click", () => {
        console.log(index, data.length);
        if (index < data.length) {
            handleNextButton();
        } else {
            startQuiz();
        }
    });
    startQuiz();

</script>

